{"version":3,"file":"cli.js","sources":["../src/prog.js","../src/utils.js","../src/log-error.js","../src/cli.js"],"sourcesContent":["import sade from 'sade';\nlet { version } = require('../package');\n\nconst toArray = val => (Array.isArray(val) ? val : val == null ? [] : [val]);\n\nexport default handler => {\n\tconst cmd = type => (str, opts) => {\n\t\topts.watch = opts.watch || type === 'watch';\n\t\topts.compress =\n\t\t\topts.compress != null ? opts.compress : opts.target !== 'node';\n\t\topts.entries = toArray(str || opts.entry).concat(opts._);\n\t\thandler(opts);\n\t};\n\n\tlet prog = sade('microbundle');\n\n\tprog\n\t\t.version(version)\n\t\t.option('--entry, -i', 'Entry module(s)')\n\t\t.option('--output, -o', 'Directory to place build files into')\n\t\t.option('--format, -f', 'Only build specified formats', 'es,cjs,umd')\n\t\t.option('--watch, -w', 'Rebuilds on any change', false)\n\t\t.option('--target', 'Specify your target environment', 'web')\n\t\t.option('--external', `Specify external dependencies, or 'none'`)\n\t\t.option('--globals', `Specify globals dependencies, or 'none'`)\n\t\t.example('microbundle --globals react=React,jquery=$')\n\t\t.option('--define', 'Replace constants with hard-coded values')\n\t\t.example('microbundle --define API_KEY=1234')\n\t\t.option('--alias', `Map imports to different modules`)\n\t\t.example('microbundle --alias react=preact')\n\t\t.option('--compress', 'Compress output using Terser', null)\n\t\t.option('--strict', 'Enforce undefined global context and add \"use strict\"')\n\t\t.option('--name', 'Specify name exposed in UMD builds')\n\t\t.option('--cwd', 'Use an alternative working directory', '.')\n\t\t.option('--sourcemap', 'Generate source map', true)\n\t\t.example(\"microbundle --no-sourcemap # don't generate sourcemaps\")\n\t\t.option('--raw', 'Show raw byte size', false)\n\t\t.option(\n\t\t\t'--jsx',\n\t\t\t'A custom JSX pragma like React.createElement (default: h)',\n\t\t);\n\n\tprog\n\t\t.command('build [...entries]', '', { default: true })\n\t\t.describe('Build once and exit')\n\t\t.action(cmd('build'));\n\n\tprog\n\t\t.command('watch [...entries]')\n\t\t.describe('Rebuilds on any change')\n\t\t.action(cmd('watch'));\n\n\t// Parse argv; add extra aliases\n\treturn argv =>\n\t\tprog.parse(argv, {\n\t\t\talias: {\n\t\t\t\to: ['output', 'd'],\n\t\t\t\ti: ['entry', 'entries', 'e'],\n\t\t\t\tw: ['watch'],\n\t\t\t},\n\t\t});\n};\n","import fs from 'fs';\nimport { promisify } from 'es6-promisify';\n\nexport const readFile = promisify(fs.readFile);\n// export const writeFile = promisify(fs.writeFile);\nexport const stat = promisify(fs.stat);\nexport const isDir = name =>\n\tstat(name)\n\t\t.then(stats => stats.isDirectory())\n\t\t.catch(() => false);\nexport const isFile = name =>\n\tstat(name)\n\t\t.then(stats => stats.isFile())\n\t\t.catch(() => false);\nexport const stdout = console.log.bind(console); // eslint-disable-line no-console\nexport const stderr = console.error.bind(console);\n","import chalk from 'chalk';\nimport { stderr } from './utils';\n\nexport default function(err) {\n\tconst error = err.error || err;\n\tconst description = `${error.name ? error.name + ': ' : ''}${error.message ||\n\t\terror}`;\n\tconst message = error.plugin\n\t\t? `(${error.plugin} plugin) ${description}`\n\t\t: description;\n\n\tstderr(chalk.bold.red(message));\n\n\tif (error.loc) {\n\t\tstderr();\n\t\tstderr(`at ${error.loc.file}:${error.loc.line}:${error.loc.column}`);\n\t}\n\n\tif (error.frame) {\n\t\tstderr();\n\t\tstderr(chalk.dim(error.frame));\n\t} else if (err.stack) {\n\t\tconst headlessStack = error.stack.replace(message, '');\n\t\tstderr(chalk.dim(headlessStack));\n\t}\n\n\tstderr();\n}\n","#!/usr/bin/env node\n\nimport microbundle from '.';\nimport prog from './prog';\nimport { stdout } from './utils';\nimport logError from './log-error';\n\nconst run = opts => {\n\tmicrobundle(opts)\n\t\t.then(output => {\n\t\t\tif (output != null) stdout(output);\n\t\t\tif (!opts.watch) process.exit(0);\n\t\t})\n\t\t.catch(err => {\n\t\t\tprocess.exitCode = (typeof err.code === 'number' && err.code) || 1;\n\t\t\tlogError(err);\n\t\t\tprocess.exit();\n\t\t});\n};\n\nprog(run)(process.argv);\n"],"names":["require","version","const","toArray","val","Array","isArray","handler","cmd","type","str","opts","watch","compress","target","entries","entry","concat","_","prog","sade","option","example","command","default","describe","action","argv","parse","alias","o","i","w","readFile","promisify","fs","stat","stdout","console","log","bind","stderr","error","err","description","name","message","plugin","chalk","bold","red","loc","file","line","column","frame","dim","stack","headlessStack","replace","run","microbundle","then","output","process","exit","catch","exitCode","code","logError"],"mappings":"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"}